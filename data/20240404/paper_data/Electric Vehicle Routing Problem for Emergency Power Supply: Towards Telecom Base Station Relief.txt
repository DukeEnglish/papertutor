Electric Vehicle Routing Problem for Emergency Power Supply:
Towards Telecom Base Station Reliefâˆ—
DaisukeKikutaâ€ ,HirokiIkeuchiâ€ ,KengoTajiriâ€ ,
YutaToyamaâ€¡,MasaskiNakamuraâ€¡,YuusukeNakanoâ€ 
â€ NTTCorporation,â€¡NTTDOCOMO
{daiuske.kikuta,hiroki.ikeuchi,kengo.tajiri,yuusuke.nakano}@ntt.com
{yuuta.toyhama.zg,masaki.nakamura}@nttdocomo.com
ABSTRACT
Asatelecomprovider,ourcompanyhasacriticalmissiontomain-
taintelecomservicesevenduringpoweroutages.Toaccomplish
themission,itisessentialtomaintainthepowerofthetelecom
basestations.Hereweconsiderasolutionwhereelectricvehicles
(EVs)directlysupplypowertobasestationsbytravelingtotheir
locations.ThegoalistofindEVroutesthatminimizeboththetotal
traveldistanceofallEVsandthenumberofdownedbasestations.
Inthispaper,weformulatethisroutingproblemasanewvariantof
theElectricVehicleRoutingProblem(EVRP)andproposeasolver
thatcombinesarule-basedvehicleselectorandareinforcement
learning(RL)-basednodeselector.Theruleofthevehicleselec-
torensurestheexactenvironmentalstateswhentheselectedEV
startstomove.Inaddition,thenodeselectionbytheRLmodel
enablesfastroutegeneration,whichiscriticalinemergencies.We
evaluateoursolveronbothsyntheticdatasetsandrealdatasets.
Figure1:Anillustrationoftelecombasestationrelief.EVs
Theresultsshowthatoursolveroutperformsbaselinesintermsof
directlysupplypowertobasestationsbytravelingtotheir
theobjectivevalueandcomputationtime.Moreover,weanalyze
locations.EachEVreturnstoachargestationlocatedoutside
thegeneralizationandscalabilityofoursolver,demonstratingthe
theblackoutareabeforetheEVpowerrunsout.
capabilitytowardunseensettingsandlarge-scaleproblems.Check
alsoourprojectpage:https://ntt-dkiku.github.io/rl-evrpeps.
powersourceforauxiliaryservices.Inthecontextofemergency
KEYWORDS
powersupply,EVsaresuperiortoconventionalpower-supplyvehi-
ElectricVehicleRoutingProblem,EmergencyPowerSupply,Deep clesinthefollowing:CompaniescanuseEVsascompanyvehicles
ReinforcementLearning,Multi-AgentSystem innormaltimes,therebyreducingwasteofresources;MoreEVs
canbedispersedoverawiderareabecausethecostperEVisless
1 INTRODUCTION expensive.AlthoughtheamountofelectricitytransportedperEV
inasinglerouteislessthanthatofapower-supplyvehicle,EVs
Asthefrequencyofnaturaldisastersincreases[24],maintaining
aremoresuitableinourproblemsettings,giventheneedtopower
infrastructuresduringadisasterisbecomingmorecritical.Inpartic-
manydispersedbasestationsindividually.
ular,telecomservicesareoneofthemostimportantinfrastructures
Recently,variousapproacheshaveemergedthatapplyvehicle-
tobealwaysmaintainedastheInternetisnowadaysalifelinefor
to-grid(V2G)orvehicle-to-home(V2H)technologiesforemergency
people.Asatelecomprovider,ourgroupcompanyiscommittedto
powersupply[37â€“39].However,duetoitshighinstallationcost,
initiativestokeepprovidingtelecomservicesevenduringadisaster.
introducingthegridsystemtonumerousexistingbasestationsis
Inthispaper,weintroduceaninitiativetomaintainthepowerof
impracticable.Furthermore,one-to-onedispatchin[37]isineffi-
telecombasestationsduringpoweroutages,whichisoneofthe
cientinthebasestationreliefwherethenumberofEVsissmaller
fundamentaltasksofmaintainingtelecomservicesduringadisaster
thanthenumberofbasestationstoberescued.Hence,apartfrom
withpoweroutages.Eachbasestationpossessesasparebattery
theseexistingapproaches,aroutingapproachwhereEVsmaintain
forshort-timebackup(e.g.,aroundthreehours),butanadditional
thepowerofthebasestationsbygoingaroundtopowerthebase
powersupplyfromsomeexternalsourcesisrequiredtomaintain
stationsdirectlyshouldalsobeconsidered.
thebasestationbatteriesoveralongertime.
Inthispaper,weformulatethisroutingproblemasavariantof
Electricvehicles(EVs)arepromisingcandidatesforthoseexter-
theElectricVehicleRoutingProblem(EVRP)andproposeasolver
nalsources.EVscansupplytheirpowertoobjectsusingvehicle-to-
everything(V2X),1whichhasrecentlygainedattentionasamobile thatcombinesarule-basedvehicleselectorandareinforcement
learning(RL)-basednodeselector.Figure1illustratesourproblem
(wenameitEVRPforEmergencyPowerSupply(EVRP-EPS)).The
âˆ—Preprint.Workinprogress.
1V2Xhererefersto"electricitytransfer"fromEVstoeverything,not"communication". goalistofindEVroutesthatminimizeboththetotaltraveldistance
4202
rpA
3
]CO.htam[
1v84420.4042:viXraTable1:Notation.
Notation Description Unit
ğ‘bs,ğ‘cs,ğ‘,ğ‘ev Thenumberofbasestations,chargestations,nodes,andEVs -
ğ‘=ğ‘bs+ğ‘cs
ğ‘–,ğ‘—,ğ‘˜,ğ‘› Theindicesofbasestations,chargestations,EVs,andnodes -
ğ‘›=1,...,ğ‘–,...,ğ‘bs,ğ‘bs+1,...,ğ‘bs+ğ‘—,...,ğ‘
bsğ‘–,csğ‘—,evğ‘˜ ğ‘–-thbasestation,ğ‘—-thchargestation,andğ‘˜-thEV -
ğ‘ğ‘˜ Theindicesofactionstakenbytheğ‘˜-thEV -
Î ğ‘˜(ğ‘ğ‘˜),ğœ‹ğ‘˜(ğ‘ğ‘˜) Therandomvariableandobservedvalueofindicesofnodes -
visitedbyğ‘˜-thEVatğ‘-thaction
ğ‘¡,ğ‘‡ Continuoustimeandtimehorizon h
ğµ(bsğ‘–,ğ‘¡) ğ‘–-thbasestationâ€™sbatteryatthetimeğ‘¡ kWh
ğ¶(bsğ‘–) ğ‘–-thbasestationâ€™spowerconsumption kWh/h
ğ‘„(bsğ‘–) ğ‘–-thbasestationâ€™scapacity kWh
ğ·(csğ‘—) ğ‘—-thchargestationâ€™sdischargerate kWh/h
ğµ(evğ‘˜,ğ‘¡) ğ‘˜-thEVâ€™sbatteryatthetimeğ‘¡ kWh
ğ¶ ğ‘„( (e ev vğ‘˜ ğ‘˜)
)
ğ‘˜ğ‘˜ -- tt hh EE VVâ€™ â€™s scd ari pv ai cn ig typowerconsumption kkW Whh/km Figure2:AnillustrationoftheEVactioncycle:moveâ†’pre-
ğ·(evğ‘˜) ğ‘˜-thEVâ€™sdischargerate kWh/h pareâ†’(dis-)chargeâ†’clean-upâ†’moveâ†’Â·Â·Â·
ofallEVsandthenumberofdownedbasestationsinasituation
whileminimizingthetotaltraveldistanceofallEVs.Formally,the
wherethebasestationbatteriescontinuouslydepleteovertime.
objectivefunctionbelowisminimized.
ComparedtoexistingEVRPs,whichconsiderbatteryconsumption
a dn isd chre ac rh gear og fin Eg Vsof anE dVs s, oE mV eR dP e- tE aP ilS smad ad nit di ao tn oa rl yly inco pn rasi cd te icr es .t Ohe urb sa ott le vr ey
r
âˆ‘ï¸ğ´ âˆ‘ï¸ğ‘˜âˆ’1d(ğ’™ğœ‹ğ‘˜(ğ‘ğ‘˜),ğ’™ğœ‹ğ‘˜(ğ‘ğ‘˜+1)) +ğ›¼1 âˆ« ğ‘‡ (cid:205) ğ‘–I(ğµ(bs ğ‘–,ğ‘¡)=0)
ğ‘‘ğ‘¡,
generatesEVroutesbyalternatelyrepeatingthetwocomponents: ğ‘˜ ğ‘ğ‘˜
ğ‘ev ğ‘‡
ğ‘¡=0
ğ‘
bs
(1)
ThevehicleselectorselectstheEVthatcanmakethenextmove
theearliest;Thenodeselectorthendeterminesthenextdestination
whereğ´
ğ‘˜
thenumberofğ‘˜-thEVâ€™sactions,d(Â·,Â·) isthedistance
oftheselectedEVwiththecentralizedstochasticpolicy.Therule between two points, ğ’™ğ‘› is the 2d coordinates of theğ‘›-th node,
ofthevehicleselectorensurestheexactenvironmentalstateswhen ğœ‹ ğ‘˜(ğ‘ ğ‘˜) istheindexofnodevisitedbyğ‘˜-thEVatğ‘-thaction,ğ›¼
theselectedEVstartstomove.Furthermore,theRL-basednode
isthepositiveweightingfactor,andI(Â·)istheBooleanindicator
function.ThefirstandsecondtermsofEq.(1)correspondtothe
selectionenablesfastroutegeneration,eveninlarge-scaleproblems,
traveldistanceofallEVsandthenumberofdownedbasestations,
whichiscriticalduringemergencies.
respectively.
Weevaluateoursolveronsyntheticandrealdatasetsthatinvolve
actuallocationsandspecificationsofbasestations,chargestations,
2.2 (Sub-)ActionsandActionSpace
andEVs.Theresultsshowthatoursolveroutperformsbaselines
(twonaiveapproachesandaconventionalheuristic)intermsof EVs/driverscyclethroughanaction:moveandthreesubsequent
boththeobjectvalueandcomputationtime.Moreover,weanalyze sub-actions:prepare,(dis-)charge,andclean-up (Figure2).First,
thegeneralizationandscalabilityofoursolver,demonstratingthe eachEVmovestoanode(i.e.,basestation/chargestation).After
capabilitytowardsunseensettingsandlarge-scaleproblems. arriving at the node, it prepares the equipment to (dis-) charge
Contributionsofthispaperareorganizedasfollows. power.Thenit(dis-)chargepoweratabasestation/chargestation.
â€¢ Wearethefirsttoformulatebasestationreliefasanew
Lastly,itclean-upstheequipmentandmovestoanothernode,and
soon.EVskeepthiscycleduringagiventimehorizon.
EVRPthatadditionallyconsidersthedischargingofEVs.
Here,theactionspaceissolelyaboutdeterminingwhichnode
â€¢ Weproposeasolverthatcombinesarule-basedvehicle
selector,anRL-basednodeselector,andanewobjective
eachEVmovestofromthecurrentnodeinthemovephase.The
sub-actions(i.e.,howlong(much)EVs(dis-)chargepowerandhow
functionthatconsidersbothtraveldistanceandthenumber
longpreparation/cleanuptakes)areincidentallydeterminedbythe
ofdownedbasestations.
environmentstateswhentheEVvisitsthatnodeandconstraints.
â€¢ We demonstrate the effectiveness of our solver on real
datasets that involve actual locations and specifications
2.3 BatteryFluctuationModel
ofbase/chargestationsandEVs.
Thebatteryofbasestations/EVslinearlyandcontinuouslychanges
2 PROBLEMSETTING withtime.Letğœbecontinuouselapsedtime,thebatteryofğ‘–-thbase
stationchangesdependingonconditions,asfollows:
Inthissection,wedescribetheEVRP-EPS,includingtheobjective
f su tan tc ioti no sn a, nth de Ea Vc st ,io ann dsp oa thc ee r,t ch oe nsb ta rt at ie nr ty s.fl Ou uc rtu na ot ti ao tn iom no isd oe rl go af nb iza es de
ğµ(bs
ğ‘–,ğ‘¡+ğœ)=ï£±ï£´ï£´ï£²
ğµ(bs ğ‘–,ğ‘¡)+(ğ·(ev ğ‘˜)âˆ’ğ¶(bs ğ‘–))ğœ i pf oe wv
ğ‘˜
erd ai tsc bh sa ğ‘–,rges
inTable1. ï£´ï£´ ğµ(bs ğ‘–,ğ‘¡)âˆ’ğ¶(bs ğ‘–)ğœ otherwise,
ï£³
(2)
2.1 ObjectiveFunction
whereğ·(ev ğ‘˜)âˆ’ğ¶(bs ğ‘–) >0alwaysholds,meaningthattheamount
Givenatimehorizonğ‘‡ (e.g.,expectedblackoutduration)andaset ofpowersupplyfromanEVtoabasestationalwaysexceedsthe
ofbasestations,chargestations,andEVs,thegoalistomaintain powerconsumptionofthatbasestation.Duringtheğ‘˜-thEVdis-
asmanybasestationbatteriesaspossibleduringthetimehorizon charges power at theğ‘–-th base station, the battery of that baseFigure3:Anoverviewofoursolver.ItfirstselectstheEVthatwillbetheearliestavailableforthenextmove.Then,itdetermines
thenextdestinationoftheselectedEVwithacentralizedstochasticpolicy,whichisparameterizedbyatwo-towerTransformer.
stationincreasesinproportiontotheelapsedtimewiththeğ‘˜-th ofdischargeisthetimeittakesforthebasestationbatterytobe
EVdischargerateminustheğ‘–-thbasestationpowerconsumption chargeduptoğ›¾ âˆˆ [0,1]Ã—100%ofitscapacityiftheEVbatteryis
asacoefficient.Otherwise(i.e.,duringnoEVarrivesatoranEV sufficient.Otherwise,thetimeittakesfortheEVtodischargeuntil
prepares/clean-upsatğ‘–-thbasestation),thebatteryofthatbase itsdischargelimitisreached.Asthechargespeeddecreasesafter
stationdecreasesinproportiontotheelapsedtimewiththepower exceeding80%ofthebattery,weusuallysetğ›½andğ›¾to0.8.Theğ‘˜-th
consumptionasaconstant. EVdischargelimitatğ‘–-thbasestationğ¿ğ‘–ğ‘š(ev ğ‘˜,bs ğ‘–)iscalculated
Ontheotherhand,thebatteryofğ‘˜-thEVchangesasfollows: as,
ğµ(ev
ğ‘˜,ğ‘¡+ğœ)=ï£±ï£´ï£´ï£´ï£´ï£²
ï£´ï£´ï£´ï£´
ğµ
ğµ
ğµ
ğµ(
(
(
(e
e
e
ev
v
v
vğ‘˜
ğ‘˜
ğ‘˜
ğ‘˜,
,
,
,ğ‘¡
ğ‘¡
ğ‘¡
ğ‘¡)
)
)
)âˆ’
âˆ’
+ğ·ğ¶ ğ·( ((e cev svğ‘˜
ğ‘—ğ‘˜
))
)
ğœğ‘‰ ğœğœ oi
i
if
f
f
the
e
ev
v
v
eğ‘˜
ğ‘˜
ğ‘˜
rwm
d
c
ihi
sso
a
ecv
r
,he gas
er sg ae ts cp so ğ‘—wer
w ityh .e
Ereğ¿ qğ‘– ğœ‡ğ‘š
(5âˆˆ
)(e e[v n0ğ‘˜ s,, u1b
]
rs eğ‘–
i
ss) tt=
hh
aem tda
ti
hx
s
ec(cid:18) hğœ‡ Eağ‘„ Vrg( se
e
tv olğ‘˜
o
p)
w
s,ğ‘‰
e dr
isÂ·
l
cim
m
hğ‘—i ain
t
rgr(cid:16) iad nt(
i
gğ’™ ob pts ooğ‘–, wtğ’™
h
ec
e
rsğ‘—
E
w) V(cid:17) h(cid:19) ec,
nap
ta( h5
c
e)
-
ï£³ (3) dischargelimitisreached,sothatitisabletoreturntoatleastone
whereğ‘‰ istheconstantEVdrivingspeed(km/h).Duringğ‘˜-thEV depotwithoutrunningoutofitsbatteryontheway.
moves,itsbatterydecreasesproportionatelytothetraveldistance
ğ‘‰ğœ with the driving power consumption as a constant. During 2.5 OtherConstraints
ğ‘˜-th EV charges power from ğ‘—-th charge station, its battery in-
ThestatesofbasestationsandEVsalwayssatisfythefollowing
creasesproportionatelytotheelapsedtimewiththedischargerate
constraints:
ofthatchargestationasaconstant.Otherwise(i.e.,duringğ‘˜-thEV
prepares/clean-ups),theEVbatterydoesnotchange. 0â‰¤ğµ(bs ğ‘–,ğ‘¡) â‰¤ğ‘„(bs ğ‘–), (6)
2.4 DurationofEV(Sub-)Actions ğ¶(ev ğ‘˜)Â·(cid:18) d(ğ’™ğ‘¡,ğ’™ğ‘›)+m ğ‘—in(cid:16) d(ğ’™ğ‘›,ğ’™csğ‘—)(cid:17)(cid:19) â‰¤ğµ(ev ğ‘˜,ğ‘¡) â‰¤ğ‘„(ev ğ‘˜),
ThedurationofeachEV(sub-)actionğœâ€²isdeterministicallycom- (7)
putedasfollows:
Theotherunformulatedconstraintsaresummarizedbelow.
ğœâ€²
=ï£±ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£² md ğ›½ğ‘„(cid:16) iğ’™ n(ğœ‹ eğ‘˜ (cid:16)v(
ğ›¾ğ‘˜
ğ·ğ‘ ğ‘„)) ğ‘‰ (, âˆ’ğ’™
c
(ğµ
bsğœ‹
ğ‘—
sğ‘˜
(
ğ‘–)e( )ğ‘
v
âˆ’+ ğ‘˜1 ğµ,ğ‘¡)
s
((cid:17)
t b)
sğ‘–,ğ‘¡st),
i
i
if
f
fe
e
ev
v
vğ‘˜
ğ‘˜
m
c dh
iso
a
cv
r
he
g
as
e
r,
s ga et sc ps
oğ‘—
w,
er
â€¢
â€¢
I a
b
I
tn
f
hn
a
emsoth et sohe
as
re mtm ear eto E tiv
ho
tVe
ian
mnp s at eh a
t
t
,a wy
t
Es hse
o
V, e, si EE . se cV
a
V. h, ms
s
and
re
so go
tt
a
em in
ym
io o
ne
at r
.
te tc hh tt ehho eo a ons rse da2 eb
m
rEa es iV ne s cs whst t aa hat
r
iyi
g
co hean ts
s
tht ta h
a
et te yw ios hh a
n
amic vah ee
t
ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£´
ï£³
Î”ğ‘¡pre,ğµ
Î”(ğ·
ğ‘¡e
cv( lğ‘˜e nv ,ğ‘¡ğ‘˜ st) ğ·)âˆ’
âˆ’
(ğ¶
ğ¿
evğ‘–(
ğ‘š
ğ‘˜bs )ğ‘– (e)
v ğ‘˜,bsğ‘–)(cid:17)
ia ft eb vs ğ‘˜ğ‘˜ ğ‘–,
prepares/clean-ups,
3
MEa nr Tor ti Hhv ie
n
Od g, D)w
u
Oi nth
t
Lilt Oh the Ge(ğ‘ Yğ‘-+ th1) E- Vth hE aV sfiin nit sh he eq du ce hu ae rgst ia ny gi .ng(doing
(4)
whereğ‘¡stisthetimeatwhicheachactionstarts,andÎ”ğ‘¡ pre/clnisapre- Here,weintroduceoursolverfortheEVRP-EPS,whichhasbeen
definedconstanttimeforEVspreparing/cleanuping.Theduration definedintheprevioussection.OursolvergeneratesEVroutesby
ofmove(traveltime)iscalculatedassumingthatthevehiclespeed repeatingthetwocomponents,vehicleselectorandnodeselector
isconstant.ThedurationofchargeisthetimeittakesfortheEV (Figure3).Inthevehicleselector,anEVisselectedthatfinishes
tobechargeduptoğ›½ âˆˆ [0,1]Ã—100%ofitscapacity.Theduration clean-upthesoonestfromthecurrenttime.Inthenodeselector,thenextdestinationnodeoftheselectedEVisdeterminedbyatwo- ItthenproducesthefinalembeddingsofnodesandEVsbystack-
towerTransformer-basedmodel,whichparameterizesastochastic ingğ¿ofthefollowingTransformerencoders[32].
p deo sl tic iny a. tA iof nte nr ot dh ee ,as ne ole thct ee rd EVEV wis lt la br ets set lo ecm teo dv te hato tfit nh ie shd ee st ce lr em anin -ued p ğ’‰ n(ğ‘™ o) değ‘› =Xfmr n(ğ‘™ o) değ‘› (cid:16) ğ’‰ n(ğ‘™ oâˆ’ d1 e) 1,...,ğ’‰ n(ğ‘™ oâˆ’ d1 e) ğ‘(cid:17) , (13)
t eh ae chso co on me pst o, na en nd t,s ho oo wn. toIn trt ah ie nf oo ull row soi ln vg e, r,w ae ndde hs oc wrib te ot gh ee nd ee rt aa teils tho ef ğ’‰e(ğ‘™ v)
ğ‘˜
=Xfmr e(ğ‘™ v)
ğ‘˜
(cid:16) ğ’‰e(ğ‘™ vâˆ’ 11),...,ğ’‰e(ğ‘™ vâˆ’ ğ¾1)(cid:17) , (14)
finalroutes. whereXfmr(ğ‘™) ,Xfmr(ğ‘™) aretheğ‘™-thTransformerencodersfor
nodeğ‘› ev ğ‘˜
nodes and EVs, of which subscript indicate the output element.
3.1 VehicleSelector
NotethatnopositionalencodingisusedhereasnodesandEVsare
IntheEVactioncycle,EVscanmovetothenextdestinationnode permutation-invariant.
onlyafterfinishingtheclean-up.Therefore,weemployarule-based Finally, the (conditional) probability of visiting each node is
vehicleselectorthatalwaysselectsanEVthatfinishesclean-upthe computedfromthescaleddot-productattentionbetweenthefinal
soonestfromthecurrenttime.Formally,theindexoftheselected embeddingsofnodesandtheselectedEVs,asfollows.
vehicleğ‘˜Â¯isobtainedbytheArguminfunctionoftheunmovable
durationofallEVs: ğ‘¢(ğ‘˜,ğ‘›)=ï£±ï£´ï£´ï£² ğœ‚Â·tanh(cid:18) ğ’’âŠ¤ evğ‘˜âˆšğ’Œ ğ‘‘n kodeğ‘›(cid:19) ifnode ğ‘›isvisitable,
(15)
ğ‘˜Â¯ =argmin[ğ‘ˆ(ev ğ‘˜,ğ‘¡)], (8) ï£´ï£´ âˆ’âˆ otherwise,
ğ‘˜ ï£³
w timhe ere ğ‘¡.ğ‘ˆ It( ie sv uğ‘˜ p,ğ‘¡ d) ai ts et dh weu hn em no thv eab ğ‘˜l -e thdu Er Vati so tn aro tsfğ‘˜ m-t oh viE nV ga at st fh oe llc ou wrr se :nt ğ‘ ğœƒ
(cid:16)
Î  ğ‘˜Â¯(ğ‘
ğ‘˜Â¯)=ğ‘›|Sğ‘¡ğ‘ğ‘˜Â¯,ğ‘˜Â¯(cid:17)
=
(cid:205)
ğ‘šğ‘’ğ‘¢ ğ‘’( ğ‘¢ğ‘˜Â¯, (ğ‘› ğ‘˜Â¯)
,ğ‘š), (16)
ğ‘ˆ(ev ğ‘˜,ğ‘¡)=ï£±ï£´ï£´ï£´ï£´ï£²
ï£´ï£´ï£´ï£´
ğœ ğœm mâ€² â€²o ov ve e+ +Î” Î”ğ‘¡ ğ‘¡p pr re e+ +ğœ ğœd câ€²
â€²
his ac rh ga erg +e Î”+ ğ‘¡Î” clnğ‘¡ cln I a
I
af fb ce
e
hav vs ağ‘˜ ğ‘˜e rgm ms eto oa sv vt tie
e
aos
s
tn it
t
o,o
o
n,
w k
a
coreh
e
nye str ğ’Œ ire sn
a
tğœ‚ o
i
snd( oe a= ğ‘› fb1
l
t=
e
h0) eğ‘Š pi
r
ss oğ¾ tat jğ’‰h
e
tee cn( sğ¿ toc id) ol oei fnp ğ‘› ap ,
m
lğ‘‘i ln k
a
bg
t
ai rw s
si
ecti hd
e
sst e th
,
ad,
a
ti it nm oh
d
ne e sSnq ,u s
ğ‘¡
cie ho ir
s
any
rt
goğ’’
h
efe ev t sğ‘˜ h
g
tale=
o
tk ibğ‘Š oe
a
ny lğ‘„ s,
s
,ğ‘Šğ’‰
t
aae( ntğ‘„ğ¿ v
e
dğ‘˜) ,, ğ‘Š
t
Eht Vh ağ¾e
st
ï£³ (9) atğ‘¡.Regardingtheconditionalbranch,abasestationisvisitableif
whereğœ mâ€² ove,ğœ dâ€² ischarge,andğœ câ€²
harge
arethedurationofmove,dis- theselectedEVcanreturntoachargingstationwithoutrunning
charge,andchargecomputedinEq.(4).Atothertimesitdecreases outofbatteryaftervisitingthatbasestation,andnootherEVsvisit
withtimeas: it.AchargestationisvisitableiftheselectedEVscanreachitfrom
thecurrentnodewithoutrunningoutofbatteryontheway.
ğ‘ˆ(ev ğ‘˜,ğ‘¡+ğœ)=ğ‘ˆ(ev ğ‘˜,ğ‘¡)âˆ’ğœ. (10)
3.3 Training
3.2 NodeSelector
WetrainthestochasticpolicywithREINFORCE[35],apolicygra-
Here,weaimtoobtainacentralizedstochasticpolicythatoutputs
dient algorithm. As the baseline, we employ the greedy rollout
theprobabilityofvisitingeachnode,giventheglobalenvironment
baselinesimilarto[15].Thegradientğ‘”iscomputedasfollows,
stateandtheindexofaselectedEV.Inthispaper,weparameterize
thisstochasticpolicywithatwo-towerTransformer-basedmodel ğ‘”=âˆ‘ï¸(cid:16) L(ğ…ğ‘)âˆ’L(ğ… ğ‘ğºğ‘… )(cid:17) âˆ‡ğœƒlogğ‘ ğœƒ(ğ…ğ‘), (17)
(ther.h.sofFigure3). ğ‘
Ourmodelfirstcomputestheinitialembeddingsofnodesand whereListhecostfunctionofEq.(1),ğ…ğ‘ istheroutegenerated
EVswithlinearprojections: bysamplingrolloutonthecurrenttrainingpolicy,ğ…GRistheroute
ğ‘
ğ’‰(0) =(cid:26) ğ‘Š bsğ’”(bs ğ‘›,ğ‘¡ ğ‘ ğ‘˜Â¯)+ğ’ƒbs ifğ‘›âˆˆ{1,...,ğ‘ bs}, g pe on lie cyra it se rd epb ly acg er dee wd iy thr to hl elo cu ut ro ren ntth tre ab ina is ne gli pn oe lip co yl aic ty t. hT eh ee ndba os fe el ain che
nodeğ‘› ğ‘Šcsğ’”(cs ğ‘›âˆ’ğ‘bs,ğ‘¡ ğ‘ ğ‘˜Â¯)+ğ’ƒcs ifğ‘›âˆˆ{ğ‘ bs+1,...,ğ‘},
epochonlyiftheimprovementbetweenthetwopoliciesismore
(11)
than5%inapairedt-testonvalidationinstances.Thesubscript
ğ’‰e(0 v ğ‘˜) =ğ‘Ševğ’”(ev ğ‘˜,ğ‘¡ ğ‘ ğ‘˜Â¯)+ğ’ƒev, (12) ğ‘ indicatestherouteisforğ‘-thinstanceofabatch.ğ‘ ğœƒ(ğ…)isthe
whereğ‘Š bs,ğ‘Šcs,ğ‘Šev,ğ’ƒbs,ğ’ƒcs,ğ’ƒevaretrainableprojectionmatrices
probabilityofgeneratingtherouteğ…,whichisfactorizedas:
ğ‘¡a ğ‘n ğ‘˜Â¯d isbi ta hs ee ts imfo er wba hs ee ns tt ha eti so en les, ctc eh da Erg Ve ts at ka eti so tn hs e, ğ‘a -n td haE cV tis o, nre (s rp ige hc tti av fe tely r. ğ‘ ğœƒ(ğ…)=(cid:214)
ğ‘˜
(cid:214)
ğ‘ğ‘˜
ğ‘ ğœƒ(ğœ‹ ğ‘˜(ğ‘ ğ‘˜)|Sğ‘¡ğ‘ğ‘˜,ğ‘˜). (18)
finishingclean-up).Theinputbase-stationstateğ’”(bs ğ‘›,ğ‘¡)includes2d
3.4 Decoding(RouteGeneration)
coordinates,capacity,consumptionrate,remainingbatteryatğ‘¡,and
expectedtimetobedowned(i.e.,thefeaturedimensionğ‘‘ =6).The Wecangeneratethefinalroutebysamplingwiththetrainedsto-
charge-stationstateğ’”(cs ğ‘›âˆ’ğ‘bs,ğ‘¡)includes2dcoordinates,discharge chasticpolicy.Thesamplingtechniqueincludesgreedydecoding,
rate,andbooleanofwhetherbeingvisitedbyanEV(i.e.,ğ‘‘ =3).The samplingdecoding,beamsearch,andMonteCarlotreesearch.In
EVstateğ’”(ev ğ‘˜,ğ‘¡) includes2dcoordinates,abooleanofwhether thispaper,weemploythesamplingdecoding,whichissimpleyet
beingatachargestation,currentphaseintheEVcycle,durationof effective. It first samples around 1k - 10k routes with sampling
eachphase,unmovableduration,capacity,andremainingbattery rollout,thenselectstheroutethatminimizesthecostfunctionthe
atğ‘¡ (i.e.,ğ‘‘ =12). mostasthefinalroute.Table2:Thestatisticsanduseofthesyntheticdatasetsand RandomNodeSelector(Rand). Itreplacesthenodeselectorof
realdatasets. oursolverwitharandomselection.GivenaselectedEV,itrandomly
selectsavisitablenodeasthenextdestinationofthatEV.Thefinal
Name ğ‘ev ğ‘
bs
ğ‘cs Area(km2) Use routeisthebestrouteamong12.8ksampledroutes,similartothe
Real-ev-6 6 33 62 46 Eval samplingdecodingofoursolver.
Real-ev-12 12 46 117 66 Eval
GreedyNodeSelector(Greed). Itreplacesthenodeselectorof
Syn-ev-6 6 50 12 100 Train/Valid/Eval
oursolverwithagreedyselection.GivenaselectedEV,itselectsa
Syn-ev-12 12 50 12 100 Train/Valid/Eval
visitablebasestationwiththelowestcurrentbatteryasthenext
Syn-ev-12S 12 25 12 100 Train/Valid
destinationofthatEV.Ifthereisnovisitablebasestation,itselects
thenearestchargestationfromthecurrentposition.
4 EXPERIMENTALSET-UPS ConstraintProgrammingonTime-SpaceNetwork(Cp-Tsn).
TheTime-SpaceNetwork(TSN)[25]duplicatesnodesalongthe
4.1 Datasets
discrete-timedirectionandconnectstwonodesatdifferentdiscrete
We evaluate our solver on synthetic datasets and real datasets. timeswithanarc.TheConstraintProgramming(CP)[9]thenfinds
Thesyntheticdatasetsaredividedintotraining,validation,and theoptimalchainofthearcs,whichcorrespondstoanEVroute.
evaluationsplits.Wetrainoursolveronthetrainingsplitandselect Asthecomputationofthevanillamodelistooexpensivetoderive
the weights of the epoch where the cost function is the lowest asolutionwithinthetimelimit,wefirstassignnodesgroupedby
onthevalidationsplit.Notethatweusegreedydecodinginthis abalancedk-meanstoeachEVandapplyCp-Tsntoeachofthe
validationphase.Wethenevaluateitontheevaluationsplitand dividedproblemsseparately.Notethatsolvingdividedproblems
realdatasets. restrictsthesearchspaceandmaypreventderivingtheoriginal
problemâ€™soptimalsolution(settlingforanear-optimalsolution).
Therealdatasets(Real-ev-6,12). Theyincludeactualdataof
TheOR-ToolsCP-SATsolver3isusedhere.Wereporttheresultsof
twodifferentregions2:theareasof Real-ev-6andReal-ev-12are
twodifferenttimeresolutions,1hand0.5h,denotedbyCp-Tsn
around46and66km2,respectively.Table2organizesthestatistics 1.0
andCp-Tsn ,respectively.
ofthesedatasets.Thelocationsandspecificationsofnodesand 0.5
EVsareactualvalues.Basestationsaredistributedinthecenter 4.3 HyperparametersandDevices
andchargestationssurroundit,emulatingtheactualsituation.We âˆš âˆš
assumethattheinitialbatteriesofbasestationsandEVsare80% TrainableparametersareinitializedwithU(âˆ’1/ ğ‘‘,1/ ğ‘‘),ğ‘‘isthe
oftheircapacities. inputdimension.Training,validation,andevaluationsplitsforthe
syntheticdatasetshave1.28M,1000,and100instances,respectively.
Thesyntheticdatasets(Syn-ev-6,12). Theyaregeneratedbased WeevaluateasolvertrainedwiththesamenumberofEVsand
on the distribution of the real datasets. Table 2 organizes their ğ‘‡ = 12astheevaluationdata.Themaximumepochis100,the
statistics.Thelocationsofnodesareuniformlysampledwithin mini-batchsizeis256,andtheconstantlearningrateis10âˆ’4.The
thesquarearea[0,100]2km2.Thespecificvaluesofbasestations,
numberofTransformerencoderlayersissetasğ¿=2,thedimension
chargestations,andEVsaresampledfromthedistributionofreal inhiddenlayersğ» = 128,andthenumberofheadsğ‘€ = 8.The
datasets.Theinitialbatteriesofbasestationsarerandomlysam- weightingfactorissetasğ›¼ =100.Therandomseedissetto1234
pledwithin50-100%ofthecapacity,andthoseofEVsareset unlessotherwisestated.AsingleGPU(RTXA6000:48G)andtwo
to80%ofthecapacity.Syn-ev-6Sisusedonlyforscalabilityand CPUs(XeonPlatinum8380(2.30GHz))areusedintheexperiments.
generalizationtests,whichisdiscussedlater.
5 EXPERIMENTALRESULTS
Parametersofbasestations,chargestations,andEVs. Wehere
considertheNissanLeafe+series,ofwhichthecapacityğ‘„(ev ğ‘˜) 5.1 PerformanceComparisonwithBaselines
=60kWh,drivingpowerconsumptionğ¶(ev ğ‘˜)=161Wh/km,dis- Table3showsthecomparisonresultsonthesyntheticdatasetsand
chargelowerlimitğœ‡=0.1.ThedischargerateofEVsissetasğ·(ev ğ‘˜) realdatasetswithğ‘‡=12,24h.Metricsareaveragedtraveldistance
=10kWh/h.Theconstantvehiclespeedissetasğ‘‰ =41km/h.The perEV(dist(km)),thetimeaverageofthenumberofdownedbase
chargeupperlimitissetto80%,i.e.,ğ›½,ğ›¾=0.8.Thedischargerateof stations(down),theobjectivevalue(obj),andtotalcomputation
chargestationsiseither3(normalcharging)or50kWh/h(rapid time(time).Here,wesetthetimelimitto30minutes,whichisthe
charging),i.e.,ğ·(cs ğ‘—)=3,50kWh/h.Prepare/cleanupduration(i.e., requirementfromthesiteworkers.Whencalculationsexceedthe
Î”ğ‘¡ pre/cln)atbasestationsandchargestationsaresetto0.5hand timelimit,wereporttheintermediateresultsobtainedatthatpoint.
10m,respectively.Eachbasestationhasitsowncapacityandcon- Inthiscomparison,objandtimearetheprimarymetrics,with
sumptionrate,detailsofwhichareomitted.Thedistancebetween distanddownconsideredasreferenceinformation.4
nodesisapproximatedbyEuclideandistance.
Oursolver(Ours). Oursconsistentlyoutperformsbaselineson
4.2 Baselines alldatasetsintermsofbothobjandtime.Notably,oursprovides
thebestobjevenonrealdatasets,wherethedistributionofnodes
Wecompareoursolverwiththefollowingsolvers.
3https://developers.google.com/optimization/cp/cp_solver
2Thenamesoftheregionsandspecificvaluesareomittedforprivacyreasons. 4Thisisbecauseobjalreadyconsidersthetrade-offsbetweendistanddown.Table3:Oursolver(Ours)v.s.baselines.MetricsareaveragedtraveldistanceperEV(dist(km)),thetimeaverageof#downed
basestations(down),theobjectivevalue(obj),andtotalcomputationtime(time).Forallvalues,smallerisbetter.
Syn-ev6(100samples) Syn-ev12(100samples)
ğ‘‡ =12h ğ‘‡ =24h ğ‘‡ =12h ğ‘‡ =24h
Model dist down obj time dist down obj time dist down obj time dist down obj time
w/oEVs - 20.1 - - - 33.3 - - - 20.1 - - - 33.3 - -
Greed 189 17.7 37.2 1s 312 29.8 62.8 1s 192 15.5 32.9 1s 317 26.6 56.4 2s
Rand(S=12800) 142 15.3 32.0 1m 263 26.5 55.5 2m 157 11.8 25.1 3m 283 21.1 45.1 6m
Ours(G) 81 12.5 25.9 1s 125 25.2 51.7 1s 78 6.63 14.0 1s 131 18.2 37.8 2s
Ours(S=1280) 78 12.4 25.5 51s 125 24.6 50.4 1m 75 6.41 13.6 1m 129 17.4 36.0 3m
Ours(S=12800) 78 12.4 25.5 9m 126 24.5 50.2 15m 74 6.38 13.5 15m 129 17.2 35.7 28m
Real-ev6(1sample) Real-ev12(1sample)
ğ‘‡ =12h ğ‘‡ =24h ğ‘‡ =12h ğ‘‡ =24h
Model dist down obj time dist down obj time dist down obj time dist down obj time
w/oEVs - 8.25 - - - 17.5 - - - 11.3 - - - 25.9 - -
Greed 30 5.87 19.4 1s 37 13.5 42.8 1s 88 9.34 21.7 1s 107 20.9 47.1 1s
Rand(S=12800) 32 3.74 13.1 1s 63 10.0 33.8 2s 120 4.98 12.8 5s 215 14.2 34.2 8s
Cp-Tsn1.0 16 5.62 17.9 1m 24 12.6 39.37 30m 47 4.54 10.62 22s 98 14.2 32.44 30m
Cp-Tsn0.5 16 3.40 11.2 11m 31 11.6 36.7 30m 53 3.32 8.06 1m 105 15.0 34.25 30m
Ours(G) 17 2.53 8.61 1s 26 8.46 27.1 1s 59 1.06 3.26 1s 99 11.1 25.6 1s
Ours(S=1280) 21 2.03 7.27 1s 35 8.37 27.3 2s 61 0.65 2.41 4s 101 10.8 25.2 6s
Ours(S=12800) 19 1.96 6.97 9s 33 8.15 26.5 15s 61 0.48 2.03 28s 100 10.6 24.7 47s
significantlydiffersfromthatofthetrainingdatasets(i.e.,uniform stations,thetimevariationinbasestation/EVbatteries,andthe
distributionv.s.twoclusters:onelocatedatthecenterandtheother routenetworkformedbyEVsâ€™traveltrajectory.
surroundingtheperimeter).Theseresultsdemonstratethatourshas Thetimevariationinthenumberofdownedbasestationspro-
thegeneralizationabilityfornodedistributionandcanbeappliedto videsmorefine-grainedperspectivesofdown,whichcorresponds
anyregion.Incomparisonbetweenthedecodingtypesofours,the to(theareaboundedbelowthecurveandbytheğ‘¥-axis)/(time
samplingdecoding(Ours(S=#samples))outperformsthegreedy horizonğ‘‡)here.Oursmaintainsthelowestnumberofdownedbase
decoding(Ours(G)).Furthermore,Weobserveanimprovement stationscomparedtoothersolversformostofthetimehorizon.
in obj asthesample sizeincreases. Thecomputationtime also ThereductionbyoursisgreaterinReal-EV12,wheretheratio
increasesatthattime,butthereisenoughmarginforthetimelimit. ofbasestationstoEVsissmallerthaninReal-EV6(3.8v.s.5.5).
Thisindicatesoursworksmoreeffectivelywhenthetheoretical
Greed&Rand. Greedalwaysprovidestheworstobj,indicating maximumnumberofbasestationsthatcanbemaintainedisgreater.
thatasimplerule-basedroutingisineffectiveinEVRP-EPS.By Regardingtheincreaseinthatnumbertowardstheendofthetime
contrast,Randprovidesrelativelyreasonableobj.Asthesenaive horizon,itispreferabletoamid-periodrise,aswehereassume
solversdonotconsiderminimizingtraveldistance,disttendsto poweroutagesareresolvedimmediatelyaftertheendofthetime
belongerthanothersolvers.ThecomparisonbetweenRandand horizon.
oursinthesamesamplesizedemonstratesthatourseffectively Thetimevariationinbasestationbatteriesshowsthatthere
samplesbetterroutes,guidedbythetrainedstochasticpolicy. arefourdistinctbasestationcapacities,andsmall-capacitybase
stationsarevisitedmanytimesinashortspanoftime.Wealso
Cp-Tsn. Itprovidesthesecond-bestobjonrealdatasets.Weob-
observethatEVsdonotvisitbasestationsthatwillnotbedown
serveanimprovementinobjasthetimeresolutionincreases.This
duringthetimehorizon,evenwithoutapowersupplyfromEVs.
isbecausehighertimeresolutionapproximatescontinuoustime
InthetimevariationinEVbatteries,weobservetwodistinct
moreclosely,therebyreducingtheredundantwaitingperiodsthat
dischargepatterns:onerepeatsasmallamountofdischargenu-
arisebetweendiscretetimeticksandthecompletionofanaction.
merous times, while the other performs a relatively substantial
However,asthesearchspacegrowsexponentiallywiththeincrease
dischargearoundtwotofivetimes.Theformercanbeassociated
intimeresolution,weshouldkeepitatareasonablevalue(e.g.,0.5-
withdischargingtosmall-capacitybasestationsthatrequirefre-
1h)tofindareasonablesolutionwithinthetimelimit.Furthermore,
quentcharging,whilethelattercorrespondstodischargingtoother
Cp-Tsnsolvessub-problemsthatarenotguaranteedtorecover
middletolarge-capacitybasestations.Despitetheabsenceofex-
theoriginalproblemfully,andthereforethatmaybewhyitsper-
plicitlysetroles,thesetworolesarisebecauseonceanEVvisitsa
formanceisinferiortoours.Overall,thepoorscalabilityofthis
small-capacitybasestation,itbecomesrationalforittocontinue
solverisamajorlimitationtoderiveareasonableroutewithina
visitingothersmall-capacitystations:Theshorterdurationofdis-
constrainedtimeframe.
charging at small-capacity basestations allows the EV there to
moveontothenextnodesoonerthanotherEVs;Itisanatural
Visualization. Figure4showsfourtypesofvisualresultsonthe
choiceforthatEVtovisitothersmall-capacitybasestationsatthat
realdatasets:ThetimevariationinthenumberofdownedbaseFigure4:Fourvisualresultsforeachrealdataset:Thetimevariationinthenumberofdownedbasestations(1strow),thetime
variationinbasestation/EVbatteries(2nd-3rdrows),andtheroutenetwork(4throw).Eachcolumncorrespondstoeachofthe
realdatasetsandincludesthosecorrespondingresults.
timeastheyarelikelydownwithinashorttime;Asaresultofthis withsmall-capacitybasestationsashubsalsoconfirmthatthese
repeated,thatEVvisitssmall-capacitybasestationsmanytimes stationsarevisitedfrequently.
whileotherEVscontinuetodischargeatonebasestation.
Thevisualizationofroutenetworksshowstwonodedistinct
5.2 ComputationalScalabilityTest
distributionsof Real-EV6,12andthetraveltrajectoryofeachEV
withdifferentcolors.Intuitively,therearenoobviouslyinefficient OneofthebiggestreasonswhyweemployaRL-basedapproach
visits,andallroutesareconsideredreasonable.Theroutenetworks isitsfastcomputationforlarge-scaleproblems.Toconfirmthis,Table4:Thestatisticsofadditionalevaluationdatasets(100
samples/dataset)forscalabilityandgeneralizationtests.Note
thatSyn-Th-*areallthesamedataset,whereonlythetime
horizonduringinferenceissetdifferently.
Name ğ‘ev ğ‘bs ğ‘cs ğ‘‡
Syn-Th-12,24,36,48 12 25 12 {12,24,36,48}
Syn-Bs-25,50,75,100 12 {25,50,75,100} 12 12
Syn-Ev-6,12,18,24 {6,12,18,24} 50 ğ‘ev 12
wehereevaluatethecomputationalscalabilityofoursolver:How
muchthecomputationtimeincreaseswithrespecttotheincrease
inthetimehorizonandthenumberofbasestationsandEVs.We
prepareadditionalevaluationdatasets,whichareorganizedinTable
Figure5:Resultsofscalabilitytest(toprow)andgeneraliza-
4.Theyaregeneratedwiththerandomseed0andthesamplesize
tiontest(bottomrow).Thepointsrepresentaveragevalues.
100.ThetrainingdatasetforSyn-Th-*andSyn-Bs-*isSyn-ev-12S,
Thefilledareaindicatesthestandarddeviation.Thedotted
whileforSyn-Ev-*,itisSyn-ev-6.ThetoprowofFigure5shows
linerepresentsthelinearincreasefromthestartingpoint.
thecomputationtimeineachdataset.Assumingactualsituations,
thecomputationtimeherereferstotheaveragetimepersample
whenderivingonerouteatatime(i.e.,thebatchsizeis1).We
Besides,theyconfirmthatinthepreviousscalabilitytest,oursolver
observedifferentbehaviorsintheincreaseofeachparameter.The
providednotonlyfastcomputationbutalsoadequateperformance.
computationtimeincreasesapproximatelyinproportiontothe
timehorizons.Thisisbecausethelengthoftheactionsequenceğ´
ğ‘˜ 6 RELATEDWORK
increasesinproportiontothetimehorizons.Withrespecttothe
increaseinthenumberofbasestations,thecomputationtimeiskept 6.1 VehicleRoutingProblem
belowthelinearincrease.Thisindicatesthatbatchparallelization
TheVehicleRoutingProblem(VRP)isacombinatorialoptimization
withGPUsandotheroptimizationssuppress,onthis(practical)
problemthataimstofindtheoptimalroutesforafleetofvehicles
scale,thequadratictimecomplexitywithrespecttothenumber
tovisitagivensetofdestinations.SinceDantzigandRamser[7]
of nodes. The computation time with respect to the number of
introduceditsconcept,numerousvariantsofVRPshavebeenpro-
EVsincreasesrapidlycomparedtootherparameters.Itappears
posedalongwiththeirsolvers.WewilldiscussrelatedvariantVRPs
that the length of the action sequence increases proportionally
(i.e.,EVRP)later,andherewefocusonthetypesofsolvers.
withthenumberofEVs,butthisisnotactuallythecase.Infact,
Thereexistsatrade-offbetweentheroutequalityandcomputa-
moreEVsleadtofrequentsmalldischargesofeachEV,resulting
tiontime,therefore,theappropriatesolvermustbechosenbased
inmorecomputationtime(i.e.,actions)thanexpected.However,
onthesituation.ExactsolverssuchastheBranch-and-Cut(-and-
thereisstillenoughmarginforthetimelimit(30minutes).Overall,
Price)algorithm[1,27]providethestrictlyoptimalroutes,while
theseresultsdemonstratethatoursolvergeneratesarouteatevery
theyhavedifficultysolvinglarge-scaleVRPsquickly.Ontheother
conceivablepracticalscalewithenoughspeedforthetimelimit.
hand,heuristics[2,12,21,33]providenear-optimalrouteswithina
reasonabletime,eveninlarge-scaleVRPs.Recently,neuralnetwork-
5.3 GeneralizationTest
basedsolvershavebeenexplored[5,13,15,23,34],whichprovide
ThetimehorizonandthenumberofEVs/nodesvarydepending fastercomputationthanheuristics.Inaddition,theycangeneratea
onthesituation.However,itisimpracticabletotrainoursolver heuristicoptimizedtoaspecificVRPfromtheVRPdata,thereby
for each case. Therefore, our solver requires the generalization overcomingthedifficultysuchthatconstructingspecializedhueris-
abilityforunseensettings.Wehereusethesamedatasetsandour ticsrequiresdeepdomainknowledge.Inthispaper,weemployan
solversasthescalabilitytest.ThebottomrowofFigure5showsthe NN-basedsolverduetothescaleandtimelimitofEVRP-EPS.The
objectivevaluesineachdataset,whichareevaluatedatthesame lackofspecializedheuristicsforEVRP-EPSalsojustifiesourchoice.
timeasthecomputationtimeinthescalabilitytest.Wereportthe AmongtheNN-basedsolvers,Transformer-basedmulti-agentRL
comparisonbetweenoursolverandnaiveapproaches(Greedand (TMARL)solversaremostrelevanttooursolver.SeveralTMARL
Rand).5Oursolverconsistentlyoutperformsthenaiveapproaches solvershavebeenproposedformulti-vehiclesettings[6,18,40,
ateveryparametersetting,whereoursolveristrainedonthemost- 43].However,theyarenotdesignedforoursituation,wherenode
leftparametersettingineachgraph.Notably,weobservethatour property(i.e.,battery)changescontinuouslyovertime,andthese
solvereffectivelyincreasestheimprovementratiointheunseen changesareinfluencedbythetimingatwhichthenodeisvisited
settingsof18and24EVs.Theseresultsdemonstratethatoursolver (multiplevisitspernodearepossible).Oursolveraddressesthisby
possessesreasonablegeneralizationcapabilitiesforunseensettings. introducingtherule-basedvehicleselector,whichallowsittofollow
theexactglobalstateinourcomplicatedsituation.Decentralized
learningisanotherchoicetoaddressthis,butweemploycentralized
5WehereexcludeCp-Tsn becauseitexceedstheindexlimitofOR-Tools(i.e.,outputs
IndexError:listindeâˆ— xoutofrange)inthemiddleofincreasingtheparameters. learningwiththerule-basedguidebecausewehereassumetheuseofourcentralizedsystemthatmonitorsthestatusofEVsand Theresultsshowthatoursolverconsistentlyoutperformsbaselines
nodes.Regardingthenodeselector,weproposethesimplesttwo- intermsoftheobjectivevalueandthecomputationtime.Wealso
towermodelamongexistingTMARLsolvers,ofwhichperformance analyzedthescalabilityandgeneralizationperformance,demon-
remainssufficient. stratingoursolverâ€™scapabilityforlarge-scaleproblemsandunseen
situations.
6.2 ElectricVehicleRoutingProblem Ontheotherhand,oursolvercurrentlyfacestwolimitations:un-
balancedworkamongEVsandonlyconsideringEuclideandistance.
TheElectricVRP(EVRP)isaVRPthatadditionallyconsidersEV
Balancingtheamountofwork(e.g.,thetraveldistanceandthe
batteryconsumptionbytravelandrechargingofEVbattery.Antici-
countofvisitingnodes)amongEVsiscriticalforimprovingtheir
patingtheintroductionofEVsinlogistics,variousworksrelatedto
fairnessifthedriversarehumans.Moreover,theeffectivenessofour
EVRPhaveappearedlately(referto[16,28]formorecomprehen-
methodwouldbereducediftheactualdistancebetweentwopoints
sivereviewsonthistopic).Here,wefocusontheproblemformu-
differssignificantlyfromtheEuclideandistance.Infuturework,
lation.TherearemanyvariantsofEVRP,wheretheconventional
wewilladdresstheseproblemsbyleveragingroute-balancingtech-
VRPvehiclesarereplacedwithEVs,andtheircharacteristicsare
niquesandavariantofTransformersthatconsidersedgefeatures,
considered.TheyincludetheElectricTravelingSalesmanProblem
whichrepresenttheactualtraveldistance.
withTimeWindows(ETSPTW)[29],EVRP[20],EVRPwithTime
Windows(EVRPTW)[8,14,30],andElectricPickupandDelivery
ProblemwithTimeWindows(EPDPTW)[10].Frommoredetailed REFERENCES
perspective,batteryconsumptionestimationaccordingtotheEVâ€™s
[1] J.R.AraqueG,G.Kudva,T.L.Morin,andJ.F.Pekny.1994.Abranch-and-cut
loadhasalsobeenstudiedtomaketheproblemmorerealistic:lin- algorithmforvehicleroutingproblems. AnnalsofOperationsResearch50,1
eardeterministic[3,36,42],non-lineardeterministic[11,19],and (1994),37â€“59. https://doi.org/10.1007/BF02085634
[2] BarrieM.BakerandM.A.Ayechew.2003.Ageneticalgorithmforthevehicle
stochasticestimation[4,26,31,41].Ourformulation,EVRP-EPS, routingproblem.Computers&OperationsResearch30,5(2003),787â€“800. https:
canbeconsideredavariantoftheInventoryRoutingProblem(IRP) //doi.org/10.1016/S0305-0548(02)00051-5
[3] RafaelBasso,BalÃ¡zsKulcsÃ¡r,BoEgardt,PeterLindroth,andIvanSanchez-Diaz.
[17],whichhasnotyetbeenstudiedinthecontextofEVRP.That
2019.EnergyconsumptionestimationintegratedintotheElectricVehicleRouting
is,theinventorycorrespondstothebasestationbattery.Regarding Problem.TransportationResearchPartD:TransportandEnvironment69(2019),
batteryconsumptionestimationinEVRP-EPS,linearmodelsare 141â€“167. https://doi.org/10.1016/j.trd.2019.01.006
[4] RafaelBasso,BalÃ¡zsKulcsÃ¡r,andIvanSanchez-Diaz.2021.Electricvehiclerouting
used,butwefoundthemsufficientbasedonactualdrivingdatain
problemwithmachinelearningforenergyprediction.TransportationResearch
oursetting. PartB:Methodological145(2021),24â€“55. https://doi.org/10.1016/j.trb.2020.12.007
[5] IrwanBello,HieuPham,QuocV.Le,MohammadNorouzi,andSamyBen-
gio.2017. NeuralCombinatorialOptimizationwithReinforcementLearning.
6.3 EVsforEmergencyPowerSupply
arXiv:1611.09940[cs.AI]
[6] GuillaumeBono,JillesS.Dibangoye,OlivierSimonin,LaÃ«titiaMatignon,and
SeveralapproachesleveragingtheV2Xtechnologyforemergency
FlorianPereyron.2021. SolvingMulti-AgentRoutingProblemsUsingDeep
powersupplyhavebeenproposed.Xuetal.[37]proposeda(dis-) AttentionMechanisms.IEEETransactionsonIntelligentTransportationSystems
chargeschedulingapproachassumingthateachhouseholdpos- 22,12(2021),7804â€“7813. https://doi.org/10.1109/TITS.2020.3009289
[7] G.B.DantzigandJ.H.Ramser.1959.TheTruckDispatchingProblem.Manage-
sessesanEV,whichmovesbackandforthbetweenthehousehold mentScience6,1(1959),80â€“91. https://doi.org/10.1287/mnsc.6.1.80
andachargestation/anotherhousehold.Yangetal.[39]consider [8] GuyDesaulniers,FaustoErrico,StefanIrnich,andMichaelSchneider.2016.
ExactAlgorithmsforElectricVehicle-RoutingProblemswithTimeWindows.
publicEVparticipantsandhaveproposedatwo-stageapproach
OperationsResearch64,6(2016),1388â€“1405. https://doi.org/10.1287/opre.2016.
thatdeterminestheparticipantsâ€™dischargeschedulingandrewards 1535arXiv:https://doi.org/10.1287/opre.2016.1535
(i.e.,money).Incontrasttotheseworks,EVRP-EPSisarouting [9] ThomFruewirthandSlimAbdennadher.2003.EssentialsofConstraintProgram-
problem (not discharge time scheduling) and ignores discharge
ming.Springer-Verlag,Berlin,Heidelberg.
[10] DominikGoeke.2019.Granulartabusearchforthepickupanddeliveryprob-
rewardingaswehereassumethatmaintainersofthebasestations lemwithtimewindowsandelectricvehicles.EuropeanJournalofOperational
(ourcompanyâ€™sworkers)operateEVs. Research278,3(2019),821â€“836. https://doi.org/10.1016/j.ejor.2019.05.010
[11] DominikGoekeandMichaelSchneider.2015.Routingamixedfleetofelectric
AlthoughitdoesnotuseEVs,theapproachin[22]sharesour andconventionalvehicles.EuropeanJournalofOperationalResearch245,1(2015),
motivationthatvehiclessupplyelectricitytotheaffectedbuilding 81â€“99. https://doi.org/10.1016/j.ejor.2015.01.049
[12] KeldHelsgaun.2017.AnExtensionoftheLin-Kernighan-HelsgaunTSPSolver
during/afteradisaster.Itusespowersupplyvehiclestosupplyelec-
forConstrainedTravelingSalesmanandVehicleRoutingProblems:Technical
tricitytobatteriesequippedwithshelters.Theauthorsformulated report.
thisproblemasavariantofVRPTW,wherethegoalistominimize [13] ChaitanyaK.Joshi,ThomasLaurent,andXavierBresson.2019. AnEfficient
GraphConvolutionalNetworkTechniquefortheTravellingSalesmanProblem.
thesumofarrivaltimeandwaitingtimeforeachshelter.Onthe
CoRRabs/1906.01227(2019).arXiv:1906.01227 http://arxiv.org/abs/1906.01227
otherhand,EVRP-EPSisavariantofIRP,wherethereisnoexplicit [14] MerveKeskinandBÃ¼lentÃ‡atay.2016.Partialrechargestrategiesfortheelectric
timewindow,andmultiplevisitstothesamenodeareallowed.This vehicleroutingproblemwithtimewindows. TransportationResearchPartC:
EmergingTechnologies65(2016),111â€“127. https://doi.org/10.1016/j.trc.2016.01.
isbecausebasestationbatteriesaredepletedrelativelyquicklyand 013
requiremultiplesuppliesduringatimehorizon. [15] WouterKool,HerkevanHoof,andMaxWelling.2019. Attention,Learnto
SolveRoutingProblems!.InInternationalConferenceonLearningRepresentations.
https://openreview.net/forum?id=ByxBFsRqYm
7 CONCLUSIONANDFUTUREWORK [16] IlkerKucukoglu,ReginaldDewil,andDirkCattrysse.2021.Theelectricvehicle
routingproblemanditsvariations:Aliteraturereview.Computers&Industrial
Inthispaper,weformulatedabasestationreliefbyEVsasavariant Engineering161(2021),107650. https://doi.org/10.1016/j.cie.2021.107650
oftheEVRPsandproposedasolverthatcombinesarule-based [17] Felipe Lagos, Natashia Boland, and Martin Savelsbergh. 2020. The
vehicleselectorandanRL-basednodeselector.Wecomparedour Continuous-Time Inventory-Routing Problem. Transportation Sci-
ence 54, 2 (2020), 375â€“399. https://doi.org/10.1287/trsc.2019.0902
solverwithbaselinesonbothsyntheticdatasetsandrealdatasets. arXiv:https://doi.org/10.1287/trsc.2019.0902[18] JingwenLi,YiningMa,RuizeGao,ZhiguangCao,AndrewLim,WenSong,and [39] ZexinYang,TianGao,YuLiu,XueliangHuang,ShanGao,QiZhao,andHongen
JieZhang.2022.DeepReinforcementLearningforSolvingtheHeterogeneous Ding.2023.Atwo-stagepricingstrategyforelectricvehiclesparticipatingin
CapacitatedVehicleRoutingProblem.IEEETransactionsonCybernetics52,12 emergencypowersupplyforimportantloads.ElectricPowerSystemsResearch
(2022),13572â€“13585. https://doi.org/10.1109/TCYB.2021.3111082 218(2023),109239. https://doi.org/10.1016/j.epsr.2023.109239
[19] JinLi,FengWang,andYuHe.2020. ElectricVehicleRoutingProblemwith [40] KeZhang,FangHe,ZhengchaoZhang,XiLin,andMengLi.2020.Multi-vehicle
BatterySwappingConsideringEnergyConsumptionandCarbonEmissions. routingproblemswithsofttimewindows:Amulti-agentreinforcementlearning
Sustainability12,24(2020). https://doi.org/10.3390/su122410537 approach. TransportationResearchPartC:EmergingTechnologies121(2020),
[20] JaneLin,WeiZhou,andOuriWolfson.2016.ElectricVehicleRoutingProblem. 102861. https://doi.org/10.1016/j.trc.2020.102861
TransportationResearchProcedia12(2016),508â€“521. https://doi.org/10.1016/j. [41] ShuaiZhang,MingzhouChen,WenyuZhang,andXiaoyuZhuang.2020.Fuzzy
trpro.2016.02.007TenthInternationalConferenceonCityLogistics17-19June OptimizationModelforElectricVehicleRoutingProblemwithTimeWindows
2015,Tenerife,Spain. andRechargingStations.ExpertSyst.Appl.145,C(may2020),12pages. https:
[21] S.LinandB.W.Kernighan.1973. AnEffectiveHeuristicAlgorithmforthe //doi.org/10.1016/j.eswa.2019.113123
Traveling-SalesmanProblem.OperationsResearch21,2(1973),498â€“516. https: [42] MengtingZhaoandYuweiLu.2019. AHeuristicApproachforaReal-World
//doi.org/10.1287/opre.21.2.498arXiv:https://doi.org/10.1287/opre.21.2.498 ElectricVehicleRoutingProblem.Algorithms12,2(2019). https://doi.org/10.
[22] QixingLiu,PengXu,YuhuWu,andTielongShen.2023.Atwo-stagealgorithm 3390/a12020045
forvehicleroutingproblemwithchargingreliefinpost-disaster.IETIntelligent [43] ZefangZong,MengZheng,YongLi,andDepengJin.2022.MAPDP:Cooperative
TransportSystems17,8(2023),1525â€“1543. https://doi.org/10.1049/itr2.12344 Multi-AgentReinforcementLearningtoSolvePickupandDeliveryProblems.
arXiv:https://ietresearch.onlinelibrary.wiley.com/doi/pdf/10.1049/itr2.12344 ProceedingsoftheAAAIConferenceonArtificialIntelligence36,9(Jun.2022),
[23] MohammadRezaNazari,AfshinOroojlooy,LawrenceSnyder,andMartinTakac. 9980â€“9988. https://doi.org/10.1609/aaai.v36i9.21236
2018. ReinforcementLearningforSolvingtheVehicleRoutingProblem.In
Advances in Neural Information Processing Systems, S. Bengio, H. Wallach,
H.Larochelle,K.Grauman,N.Cesa-Bianchi,andR.Garnett(Eds.),Vol.31.Cur-
ranAssociates,Inc. https://proceedings.neurips.cc/paper_files/paper/2018/file/
9fb4651c05b2ed70fba5afe0b039a550-Paper.pdf
[24] VisionofHumanity.2022.Ecologicalthreatreport2022:AnalysingEcological
Threats,Resilience&Peace.(2022). https://doi.org/wp-content/uploads/2022/
10/ETR-2022-Web-V1.pdf
[25] DimitriPapageorgiou,AhmetKeha,GeorgeNemhauser,andJoelSokol.2014.
Two-StageDecompositionAlgorithmsforSingleProductMaritimeInventory
Routing.INFORMSJournalonComputing26(112014),825â€“847. https://doi.org/
10.1287/ijoc.2014.0601
[26] SamuelPelletier,OlaJabali,andGilbertLaporte.2019.Theelectricvehiclerouting
problemwithenergyconsumptionuncertainty.TransportationResearchPartB:
Methodological126(2019),225â€“255. https://doi.org/10.1016/j.trb.2019.06.006
[27] ArturAlvesPessoa,RuslanSadykov,EduardoUchoa,andFranÃ§oisVanderbeck.
2020.AGenericExactSolverforVehicleRoutingandRelatedProblems.Mathe-
maticalProgramming183(2020),483â€“523. https://doi.org/10.1007/s10107-020-
01523-z
[28] HuQin,XinxinSu,TengRen,andZhixingLuo.2021.Areviewontheelectric
vehicleroutingproblems:Variantsandalgorithms. FrontiersofEngineering
Management8(052021). https://doi.org/10.1007/s42524-021-0157-1
[29] R.RobertiandM.Wen.2016. TheElectricTravelingSalesmanProblemwith
TimeWindows. TransportationResearchPartE:LogisticsandTransportation
Review89(2016),32â€“52. https://doi.org/10.1016/j.tre.2016.01.010
[30] MichaelSchneider,AndreasStenger,andDominikGoeke.2014. TheElectric
Vehicle-RoutingProblemwithTimeWindowsandRechargingStations.Trans-
portationScience48,4(2014),500â€“520. http://www.jstor.org/stable/43666939
[31] MehmetSoysal,MustafaÃ‡imen,andSedatBelbaÄŸ.2020.Pickupanddelivery
withelectricvehiclesunderstochasticbatterydepletion.Computers&Industrial
Engineering146(2020),106512. https://doi.org/10.1016/j.cie.2020.106512
[32] AshishVaswani,NoamShazeer,NikiParmar,JakobUszkoreit,LlionJones,
AidanNGomez,ÅukaszKaiser,andIlliaPolosukhin.2017.AttentionisAllyou
Need.InAdvancesinNeuralInformationProcessingSystems,I.Guyon,U.Von
Luxburg,S.Bengio,H.Wallach,R.Fergus,S.Vishwanathan,andR.Garnett
(Eds.),Vol.30.CurranAssociates,Inc. https://proceedings.neurips.cc/paper_
files/paper/2017/file/3f5ee243547dee91fbd053c1c4a845aa-Paper.pdf
[33] ThibautVidal.2022.HybridgeneticsearchfortheCVRP:Open-sourceimple-
mentationandSWAP*neighborhood. Computers&OperationsResearch140
(2022),105643. https://doi.org/10.1016/j.cor.2021.105643
[34] Oriol Vinyals, Meire Fortunato, and Navdeep Jaitly. 2015. Pointer Net-
works. In Advances in Neural Information Processing Systems, C. Cortes,
N.Lawrence,D.Lee,M.Sugiyama,andR.Garnett(Eds.),Vol.28.Curran
Associates,Inc. https://proceedings.neurips.cc/paper_files/paper/2015/file/
29921001f2f04bd3baee84a12e98098f-Paper.pdf
[35] RonaldJ.Williams.1992.SimpleStatisticalGradient-FollowingAlgorithmsfor
ConnectionistReinforcementLearning.Mach.Learn.8,3â€“4(may1992),229â€“256.
https://doi.org/10.1007/BF00992696
[36] YiyongXiao,XiaorongZuo,IkouKaku,ShenghanZhou,andXingPan.2019.
Developmentofenergyconsumptionoptimizationmodelfortheelectricvehicle
routingproblemwithtimewindows.JournalofCleanerProduction225(2019),
647â€“663. https://doi.org/10.1016/j.jclepro.2019.03.323
[37] NingZhouXu,KaWingChan,ChiYungChung,andMingNiu.2020.Enhancing
AdequacyofIsolatedSystemsWithElectricVehicle-BasedEmergencyStrategy.
IEEETransactionsonIntelligentTransportationSystems21,8(2020),3469â€“3475.
https://doi.org/10.1109/TITS.2019.2929767
[38] N.Z.XuandC.Y.Chung.2016.ReliabilityEvaluationofDistributionSystems
IncludingVehicle-to-HomeandVehicle-to-Grid. IEEETransactionsonPower
Systems31,1(2016),759â€“768. https://doi.org/10.1109/TPWRS.2015.2396524